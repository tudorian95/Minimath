# MathOps Microservice

Python microservice that supports three math operations: power, fibonacci, and factorial.

## Tech stack
- Python 3.11 lite
  - FastAPI async API
  - Async worker queue
  - SQLite logging
  - Pydantic for serialization
- Docker-ready
- Minikube-compliant

## Build and deploy on Windows
Prerequisites: 
- docker up and running
- minikube installed
- git installed (optional)

### I) Execute runDeploy.bat script
This is the recommended way to deploy the app, easy double click option :D
However, this implies the user having administrator access to the system, which might not always be the case.
A second option would be to manually execute 'WindowsDeploy.sp1'.
See the 'notes' section if you encounter any issues.

### II) Manually building the app
Select a folder in which you want to download the repository, 'cd' to said folder path and then run these commands in a new Powershell session:

### Git 
```cmd
git clone https://github.com/tudorian95/Minimath.git
```
```cmd
cd .\Minimath
```
### Docker
```cmd
docker build -t mathcontainer .
```
 (^ 'mathcontainer' being the image name already preconfigured in the deployment file for minikube)

### Minikube
```cmd
minikube start
```
```cmd
minikube image load mathcontainer:latest
```
```cmd
kubectl apply -f ./math-deployment.yaml
```
```cmd
kubectl apply -f ./math-config.yaml
```
```cmd
kubectl get pods
```
(^ should show 2 pods with running status)
```cmd
minikube service math-calculator-service --url
```
(^ will return a http link at which the app is hosted)

## Build and deploy on Linux distros
Prerequisites: 
- same as for Windows

### I) Execute UbuntuDeploy.sh script
Easy way. Just use this command and then go in the browser to interact with the app:
```cmd
./UbuntuDeploy.sh
```

### II) Manually building the app
After login (assuming it's desired to create a new folder in the user's 'home' folder):
```cmd
git clone https://github.com/tudorian95/Minimath.git
```
```cmd
cd ./Minimath
```
```cmd
docker build -t mathcontainer .
```
```cmd
minikube start --driver=docker
```
```cmd
minikube image load mathcontainer:latest
```
```cmd
kubectl apply -f math-deployment.yaml
```
```cmd
kubectl apply -f math-config.yaml
```
```cmd
kubectl get pods
```
```cmd
minikube service math-calculator-service --url
```

## Interact with the web UI
Double click on or copy paste the url generated by the 'minikube service --url' command and append '/ui' at the end of it in order to interact with the application.

Another endpoint is '/db' for a history of the operations being made.

You can also use '/docs' to inspect all endpoints.

## Notes
You might have some networking issues launching the app with the default dockerized minikube instance.
In that case, use this command, followed by running the 'runDeploy.bat' script
```cmd
'minikube start --driver=hyperv'
```
